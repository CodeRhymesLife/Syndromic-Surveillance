<html>
  <head>
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
	<style>
		#legend {
			list-style: none;
		}
		
		#legend li label, #legend li .diseaseColor {
			float: left;
		}
		
		#legend .diseaseColor{
			width: 10px;
			height: 10px;
		}
	</style>
    <script type="text/javascript">
		// A set of colors we can use in our chart
		var colors = [ "red", "green", "blue", "yellow", "purple", "orange" ];
		
		// We need to associate an id with each color to give to the
		// chart so it knows which values to associate with what colors.
		// We also use this to build our legend
		var colorCounter = 0;
		var colorIndexes = [];
		colors.forEach(function (c) {
			colorIndexes.push(colorCounter++);
		});
	
		// Contains all country data
		// Eventually, within each country we can contain city data as well.
		// So when we zoom in we can display markers for each city
		var countryData = [
			{
				name: "Haiti",
				disease: "Cholera"
			},
			{
				name: "Madagascar",
				disease: "Bubonic Plague"
			},
			{
				name: "Sierra Lione",
				disease: "Ebola"
			},
			{
				name: "Guinea",
				disease: "Ebola"
			},
			{
				name: "Liberia",
				disease: "Ebola"
			},
		];
		
		var chart = null;
		google.load("visualization", "1", {packages:["geochart"]});
		google.setOnLoadCallback(drawRegionsMap);

		/*
			Fired when a highlighted visualization (e.g. country) is selected
		*/
		function onSelect(e) {
			var selection = chart.getSelection()[0];
		}
		
		/*
			Fired when a region is selected
		*/
		function onRegionClick(e) {
			var region = e.region;
		}
		
		/*
			Builds a data table of country data for the Geochart.
			Building the data dynamically allows us to filter the data.
			For example, we can filter based on disease or country
		*/
		function buildCountryDataTable() {
			// Create the data object and add columns.
			// We don't want to display the disease column that's used for coloring,
			// so instead we add a tooltip column
			var data = new google.visualization.DataTable();
			data.addColumn('string', 'Country');
			data.addColumn("number", "DiseaseColor");
			data.addColumn({type:'string', role:'tooltip'});
			
			// Add each country to the dataset and
			// use a different color for each disease
			var colorCounter = 0;
			var diseaseColorMap = {};
			var legend = document.getElementById("legend");
			countryData.forEach(function (country) {
				// If we haven't seen this disease save it's color
				// and increment our counter
				if(!diseaseColorMap[country.disease])
				{
					// If we've used up all of our colors
					// throw an exception.
					if(colorCounter + 1 >= colorIndexes.length)
						throw "We need more colors!"
				
					diseaseColorMap[country.disease] = colorIndexes[colorCounter++];

					// Update our legend with the new color
					var diseaseLegendEntry = document.createElement("li");
					diseaseLegendEntry.innerHTML = "<div class='diseaseColor' style='background-color: " + colors[diseaseColorMap[country.disease]] + "'></div>" +
						"<label>" + country.disease + "</label>" +
						"<div style='clear: both;'></div>";
					
					legend.appendChild(diseaseLegendEntry);
				}
				
				// Add a row for the country
				data.addRow([
					country.name,						// Country
					diseaseColorMap[country.disease],	// Disease color
					"Disease " + country.disease		// Hover tooltip
				]);
			});
			
			return data;
		}
		
		/*
			Draw the chart
		*/
		function drawRegionsMap() {
			var data = buildCountryDataTable();

			var options = {
				legend: 'none',
				colorAxis: { colors: colors, values: colorIndexes }
			};

			chart = new google.visualization.GeoChart(document.getElementById('regions_div'));

			chart.draw(data, options);

			// Hook up events
			google.visualization.events.addListener(chart, 'select', onSelect);
			google.visualization.events.addListener(chart, 'regionClick', onRegionClick);
      }
    </script>
  </head>
  <body>
    <div id="regions_div" style="width: 900px; height: 500px;"></div>
	<ul id="legend">
		<!-- Items added dynamically -->
	</ul>
  </body>
</html>